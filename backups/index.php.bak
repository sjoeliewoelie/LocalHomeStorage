<?php
  require('scandir.php');
  $LocalBox = new Files();
  $LocalBox->init();
  $LBfiles = $LocalBox->OutFiles();
  session_start();
  require('vkauth.php');
  require('vkapi.php');
  $vkapi = new vkapi();
  $userinfo = $vkapi->getinfo();
  $count = 0;
  if($userinfo != false){
    $username = $userinfo->response[0]->first_name.' '.$userinfo->response[0]->last_name;
    $photo_50 = $userinfo->response[0]->photo_50;
  }
?>
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>Local Home Storage</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="">
    <meta name="author" content="">
    <!-- Le styles -->
    <link href="../assets/css/bootstrap.css" rel="stylesheet">
    <style>
      body {
        padding-top: 60px; /* 60px to make the container go all the way to the bottom of the topbar */
      }
      .span4{
        -moz-box-shadow: 1px 6px 12px -6px #888;
        -webkit-box-shadow: 1px 6px 12px -6px #888;
        box-shadow: 1px 6px 12px -6px #888;
        border-radius: 8px 8px 8px 8px;
        margin:0px 0px 20px 20px;
        max-width:151px;
        float:left;
      }
      .title{
        margin:10px 0px 10px 5px;
        float:left;
        color:gray;
      }
      .span4 .img-rounded{
        border-radius: 8px 8px 0px 0px; 
      }
      .span4 .btn-group{
        float:right;
        margin:10px 5px 10px 0px;
      }
      .span4 img{
        height:125px;
        width:370px;
        opacity:0.7;
      }
      .span4:hover{
        -moz-box-shadow: 0px 0px 10px 1px #888;
        -webkit-box-shadow: 0px 0px 10px 1px #888;
        box-shadow: 0px 0px 10px 1px #888;
      }
      .span4:hover img{
        opacity:1;
      }
    </style>
    <link href="../assets/css/bootstrap-responsive.css" rel="stylesheet">

    <!-- HTML5 shim, for IE6-8 support of HTML5 elements -->
    <!--[if lt IE 9]>
      <script src="../assets/js/html5shiv.js"></script>
    <![endif]-->

    <!-- Fav and touch icons -->
    <link rel="apple-touch-icon-precomposed" sizes="144x144" href="../assets/ico/apple-touch-icon-144-precomposed.png">
    <link rel="apple-touch-icon-precomposed" sizes="114x114" href="../assets/ico/apple-touch-icon-114-precomposed.png">
      <link rel="apple-touch-icon-precomposed" sizes="72x72" href="../assets/ico/apple-touch-icon-72-precomposed.png">
                    <link rel="apple-touch-icon-precomposed" href="../assets/ico/apple-touch-icon-57-precomposed.png">
                                   <link rel="shortcut icon" href="../assets/ico/favicon.png">
  </head>

  <body>
      <div class="navbar navbar-fixed-top">
        <div class="chevron"></div>
        <div class="navbar-inner">
          <div  class="container">
            <button type="button" class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
              <span class="icon-bar"></span>
              <span class="icon-bar"></span>
              <span class="icon-bar"></span>
            </button>
            <a class="brand" href="#">LocalBox</a>
            <div class="nav-collapse collapse">
              <ul class="nav">
                <li class="active"><a href="#">Home</a></li>
                <li><a href="#about">About</a></li>
                <li><a href="#contact">Contact</a></li>
              </ul>
              <ul class="nav pull-right">
                <?php
                  if($userinfo != false){
                    echo '<li class="usergroup"><a>'.$username.'</a></li>
                    <li class="divider-vertical usergroup"></li>
                    <li class="dropdown usergroup">
                      <a href="#" class="dropdown-toggle photo_50drop" data-toggle="dropdown">
                        <img class="photo_50" src="'.$photo_50.'">
                      </a>
                      <ul class="dropdown-menu">
                        <li><a href="#">Action</a></li>
                        <li><a href="/signout.php">Sign out</a></li>
                      </ul>

                    </li>';
                  }else{
                    echo '<li><a href="https://oauth.vk.com/authorize?client_id=3791305&scope=audio,video&redirect_uri=http://62.106.105.33/&display=popup&v=4.104&response_type=code"><i class="icon-user"></i> Sign in</a></li>';
                  } 
                ?>
              </ul>
            </div><!--/.nav-collapse -->
          </div>
        </div>
      </div>
    <!-- MAIN CONTAINER -->
    <div class="container">
      <!-- Example row of columns -->
      <div class="row">
        <?php
          foreach($LBfiles as $file){ 
            $count++;
        ?>
        
        <div class="span4">
          <img class="img-rounded" src="/assets/icons/<?php echo $file['ico'];?>">
          <?php 
            if(strlen($file['name'])>10){
              echo '<h5 title="'.$file['name'].'" class="title">'.substr($file['name'],0,7).'...</h5>';
            }else{
              echo '<h5 class="title">'.$file['name'].'</h5>';
            }
          ?>
          <!--<h5 class="title"><?php //echo $name;?></h5> -->
          <div class="btn-group">
            <a class="btn dropdown-toggle btn-mini" data-toggle="dropdown" href="#">
              Action
              <span class="caret"></span>
            </a>
            <ul class="dropdown-menu">
              <!-- dropdown menu links -->
              <?php
              switch($file['type']){
              case 'audio':
              case 'video':
              case 'image':
              case 'text':
                echo '<li><a tabindex="-1" href="'.$file['link'].'" target="_blank"><i class="icon-eye-open"></i> Open</a></li>';
              break;
              case 'folder':
                echo '<li><a tabindex="-1" href="?f='.$file['folder'].'"><i class="icon-folder-open"></i> Open</a></li>';
              break;
              };
              ?>
              <li><a tabindex="-1" href="#"><i class="icon-pencil"></i> Rename</a></li>
              <?php
                if($file['type'] == 'zip'){
                  echo '<li><a tabindex="-1" href="#"><i class="icon-share-alt"></i> Unzip</a></li>';
                };
                if($file['type'] == 'x-rar'){
                  echo '<li><a tabindex="-1" href="#"><i class="icon-share-alt"></i> Extract</a></li>';
                };
              ?>
              <?php
                if($file['type'] != 'folder'){
                  echo '<li><a tabindex="-1" href="'.$file['link'].'" download><i class="icon-download-alt"></i> Download</a></li>';
                }
              ?>
                  <?php
                    if($file['type'] != 'folder'){
                      echo '<li class="divider"></li>
                            <li>
                              <a tabindex="-1" onclick="document.forms[\'delete'.$count.'\'].submit()" href="#"><i class="icon-trash"></i> Delete</a>
                              <form style="display:none;" method="post" action="delete.php" name="delete'.$count.'">
                                <input name="delete" type="hidden" value="'.$file['directlink'].'">
                              </form>
                            </li>';
                    }
                  ?>
                </li>
            </ul>
          </div>
        </div>
        <?php
          }
        ?>
      </div>
      </div> <!-- /container -->

    <!-- FOOTER -->
    <hr>

    <footer>
      &copy; <a href="http://vk.com/k0mat0znik">Евгений Кирсанов</a> 2013
    </footer>
    <!-- remake bootstrap styles -->

    <style>
    body {
        padding-top: 60px; /* 60px to make the container go all the way to the bottom of the topbar */
      }
      .span4{
        -moz-box-shadow: 1px 6px 12px -6px #888;
        -webkit-box-shadow: 1px 6px 12px -6px #888;
        box-shadow: 1px 6px 12px -6px #888;
        border-radius: 8px 8px 8px 8px;
        margin:0px 0px 20px 20px;
        max-width:151px;
        float:left;
      }
      .title{
        margin:10px 0px 10px 5px;
        float:left;
        color:gray;
      }
      .span4 .img-rounded{
        border-radius: 8px 8px 0px 0px; 
      }
      .span4 .btn-group{
        float:right;
        margin:10px 5px 10px 0px;
      }
      .span4 img{
        height:125px;
        width:370px;
        opacity:0.7;
      }
      .span4:hover{
        -moz-box-shadow: 0px 0px 10px 1px #888;
        -webkit-box-shadow: 0px 0px 10px 1px #888;
        box-shadow: 0px 0px 10px 1px #888;
      }
      .span4:hover img{
        opacity:1;
      }
    .span4{
      float: left;
      margin-left: 20px;
    }
    .vk{
      width:30px;
    }
    .photo_50{
      width:34px;
      margin-top: 3px;
    }
    .photo_50drop{
      padding: 0px 0px 0px 0px !important;
    }
    .chevron{
      z-index: 1;
      width:100%;
      background: #fafafa;
      height:0px;
      opacity: 0.9;
      -moz-transition:all 0.7s ease;
      -o-transition:all 0.7s ease;
      -webkit-transition:all 0.7s ease;
      transition:all 0.7s ease;
    }
    .opennav{
      height:300px;
    }
    .usergroup{
      float:left !important;
    }
    .dropdown.usergroup.open{
      width:34px !important;
    }
    </style>
    <!-- Le javascript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
    <script src="/assets/js/jquery.js"></script>
    <script src="/assets/js/bootstrap.js"></script>
    <script type="text/javascript">
      $('.brand').click(function(){
        if($('.chevron').hasClass('opennav')){
          $('.chevron').removeClass('opennav');
        }else{
          $('.chevron').addClass('opennav');
        }
      });
    </script>
  </body>
</html>